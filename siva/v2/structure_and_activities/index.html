<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Structure and activities - SiVa - Validation Service Documentation</title>
      
      
      
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="SiVa - Validation Service Documentation">
    <meta property="og:image" content="None/../../../">
    <meta name="apple-mobile-web-app-title" content="SiVa - Validation Service Documentation">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../../../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../../assets/fonts/icon.eot?52m981');
      	src: url('../../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../../assets/stylesheets/application-a422ff04cc.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Roboto+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
      <link rel="stylesheet" href="../../../override.css">
    
    <script src="../../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-cyan palette-accent-light-blue">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
          </span>
        
        Structure and activities
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/open-eid/SiVa" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          SiVa - Validation Service Documentation
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          open-eid/SiVa
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/open-eid/SiVa/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/open-eid/SiVa/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Introduction" href="../../..">
      Introduction
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Version info" href="../../version_info/">
      Version info
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Definitions" href="../../definitions/">
      Definitions
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="SiVa Service Overview" href="../../overview/">
      SiVa Service Overview
    </a>
    
  </li>

          
            
  <li>
    <a class="current" title="Structure and activities" href="./">
      Structure and activities
    </a>
    
      
      
        <ul>
          
            <li class="anchor">
              <a title="Component diagram" href="#component-diagram">
                Component diagram
              </a>
            </li>
          
            <li class="anchor">
              <a title="Use cases" href="#use-cases">
                Use cases
              </a>
            </li>
          
        </ul>
      
    
  </li>

          
            
  <li>
    <a class="" title="Interfaces" href="../interfaces/">
      Interfaces
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Deployment" href="../deployment/">
      Deployment
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Quality Assurance Strategy" href="../../qa_strategy/">
      Quality Assurance Strategy
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Test Plan" href="../../test_plan/">
      Test Plan
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="References" href="../../references/">
      References
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Appendixes</span>
    <ul>
      
        
  <li>
    <a class="" title="Appendix 1 - Validation Policy" href="../../appendix/validation_policy/">
      Appendix 1 - Validation Policy
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Appendix 2 - Validation Constraint Configuration" href="../../appendix/validation_constraints/">
      Appendix 2 - Validation Constraint Configuration
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Appendix 3 - Test Case Descriptions" href="../../appendix/test_cases/">
      Appendix 3 - Test Case Descriptions
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Appendix 4 - WSDL of SOAP Interface" href="../../appendix/wsdl/">
      Appendix 4 - WSDL of SOAP Interface
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="Appendix 5 - Known Issues" href="../../appendix/known_issues/">
      Appendix 5 - Known Issues
    </a>
    
  </li>

      
    </ul>
  </li>

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
            <h1>Structure and activities</h1>
          
          <h2 id="component-diagram">Component diagram</h2>
<p><img alt="SiVa component diagram" src="../../../img/siva/siva_module_diagram.png" /></p>
<h3 id="web-api">Web API</h3>
<p>Web API is standard Spring Boot Web application module inside SiVa webapp it will take in JSON or SOAP requests sent by
systems that are integrated with SiVa web service API. The incoming requests will be converted to <strong>SiVa Proxy Module</strong>
Java request objects. Web API module also does basic validation of incoming requests. Checking that all the required
fields are present and document type is correct.</p>
<p>When validation has been completed by proxy selected validation service the returned qualified validation report Java object
will be marshalled based on incoming request to JSON or SOAP and returned to client that requested the validation.</p>
<h3 id="external-configuration-resources">External configuration resources</h3>
<ul>
<li>Optionally SiVa webapp can load in configuration file (i.e application.yml) at application startup time.
  Configuration file can control Spring Boot configuration options in addition to SiVa application
  specific options.</li>
<li>Optionally SiVa webapp can also load in logging configuration options</li>
</ul>
<h3 id="validation-proxy-service">Validation proxy service</h3>
<p><strong>Validation proxy service</strong> or validation service selector is Spring Boot module that will take the Web API sent
request object and try to find matching validation service based on the <code>documentType</code>inside the request object.
When matching validation service have been found the proxy request is converted to validation request and sent to matched
validation service.</p>
<p>When no matching validation service has not been found exception is raised and error object is
returned to Web API module. On successful validation the qualified validation report Java object sent from validation
service is returned to Web API module.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Validation services can be added dynamically to SiVa by conforming to pattern <code>documentType + "ValidationService"</code> and new
validation service module must be Maven dependency of <code>siva-validation-proxy</code>. Example
would be <code>BDOCValidationService</code>.</p>
</div>
<h3 id="validation-reporting-service">Validation reporting service</h3>
<p><strong>Validation reporting service</strong> is optional module that can be turned on or off using configuration file. It's Spring Boot module and
main purpose is to collect data about: incoming request, validation reports and errors that have been reported during validation process.</p>
<p>When HTTP authentication header have been set the reporting service will also collect its and adds to required statistics reports.</p>
<p>After the report object have been created the data will be sent to configured reporting service. SiVa is preconfigured to work with
Google Analytics.</p>
<h3 id="tsl-loader">TSL Loader</h3>
<p>TSL loader loads in contents of TSL file from given URL in online mode or from directory when
using offline mode in predefined interval.</p>
<h3 id="validation-services">Validation services</h3>
<p>All validation services use different Java library to validate given document in request. The used validation
library is described in each of the validation service section.</p>
<p>Common process that all validation services do with proxy forwarded validation process is:</p>
<ul>
<li>Convert the Base64 encoded document into <code>InputStream</code> byte array</li>
<li>Check that given document is correct format (i.e valid BDOC). If not then error is thrown and
  validation process is terminated.</li>
<li>After validation of signatures has been completed the validation service starts to build
  qualified validation report</li>
<li>Validation report is created even validation <code>FAILED</code> or ended with <code>INDETERMINATE</code> result</li>
</ul>
<h3 id="pdf-validation-service">PDF Validation service</h3>
<p>PDF or PaDES as known in DSS validation service uses <a href="https://github.com/open-eid/sd-dss">Digidoc4J DSS fork Java library</a> PaDES validation
functionality using the validation policy that complies with Estonian laws and regulations.</p>
<p>Configurable functionality:</p>
<ul>
<li>Possibility to add additional validation policies using SiVa <code>application.yml</code> configuration section.</li>
</ul>
<h3 id="bdoc-validation-service">BDOC validation service</h3>
<p>BDOC for ASiC compliant containers both TM and TS will latest Maven released <strong>DigiDoc4J</strong> library</p>
<h3 id="ddoc-validation-service">DDOC Validation service</h3>
<p>DDOC for previous generation digitally signed files will use latest Maven release of <strong>JDigiDoc</strong></p>
<h3 id="x-road-validation-service">X-Road validation service</h3>
<p>X-Road containers are similar to ASiCE containers but are <strong>not</strong> valid ASiCE containers. There we could not use DSS nor DigiDoc4J provided
ASiCE validation functionality but need to X-Road developed <code>asicverifier</code> Java command line utility to validate these containers.</p>
<p>Source code for <code>asicverifier</code> can be found in <a href="https://github.com/vrk-kpa/xroad-public/tree/master/src/asicverifier">GitHub xroad-public repository</a>*[]:
<code>Asicverfier</code> has been integrated into SiVa as Java library. Making possible to use all the Java libraries packaged into <code>asicverifier</code> fat JAR.</p>
<p>Configurable functionality:</p>
<ul>
<li>In SiVa configuration <code>application.yml</code> file You can define alternative location for <code>globalconf</code> directory to be loaded in using input stream</li>
</ul>
<h2 id="use-cases">Use cases</h2>
<h3 id="digitally-signed-document-validation-process">Digitally signed document validation process</h3>
<p>Digitally signed document validation process shows how SiVa chooses
validation service and possible output of validation process.</p>
<p><img alt="BDOC validation process" src="../../../img/siva/siva_bdoc_validation_process.png" /></p>
<p>User of SiVa system provides digitally signed document file in form of
Base64 encoded string. The validation of file and validation policy
is handled by validation services underlying libraries.</p>
<ul>
<li>In case of PDF file it will be DSS</li>
<li>For BDOC and DDOC files we will use DigiDoc4J or when required jDigiDoc</li>
<li>And for X-Road signatures we will use X-road signature validation utility</li>
</ul>
<p>We will log following failure cases:
When file upload fails (request started but was not completed successfully)
When request validation (JSON or SOAP) fails
When user authentication fails - <strong>not shown in diagram above</strong>
When signature validation fails – <strong>not shown in diagram above</strong>
When increasing of request count fails – <strong>not shown in diagram above</strong></p>
<h3 id="certificate-loading-process">Certificate loading process</h3>
<p>All validation services require certificates to validate digitally signed
documents. Below process shows how certificates are loaded into
validation service. Loading process is done separably for each validation
service.</p>
<p><img alt="Certificate Loading process" src="../../../img/siva/siva_validator_crl_loading.png" /></p>
<p>Certificate loading process is scheduled cron job inside each validation
service to update currently in memory loaded certificates.</p>
<p>This process should run after TSL loader has completed updating
SiVa local copy of certificates.</p>
<h3 id="x-road-6-security-server-soap-request-process">X-Road 6 security server SOAP request process</h3>
<p>X-Road validation process is brought out because we skip authentication
process for X-Road security server interface and and use XML SOAP
as input source.</p>
<p><img alt="X-Road SOAP validation request" src="../../../img/siva/siva_x_road_server_diagram.png" /></p>
<p>Validation of SOAP request XML is done in the SiVa web application module.
Document validation process is described in detail in <a href="#digitally-signed-document-validation-process">Digitally signed document validation process</a>
Validation report output id described in <a href="../../../siva/interface_description">Interface description</a></p>
<h3 id="tsl-loading-use-case">TSL loading use case</h3>
<p>TSL implementd in seprate module. The process is executed in two ways.</p>
<ul>
<li>When SiVa application is started</li>
<li>As scheduled job</li>
</ul>
<p>Loading process is required action when ASiCE (BDOC) or</p>
<p><img alt="TSL loading process" src="../../../img/siva/siva_tsl_loading_process.png" /></p>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../../overview/" title="SiVa Service Overview">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                SiVa Service Overview
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../interfaces/" title="Interfaces">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Interfaces
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../../..';
      var repo_id  = 'open-eid/SiVa';
    </script>
    <script src="../../../assets/javascripts/application-997097ee0c.js"></script>
    
    
  </body>
</html>